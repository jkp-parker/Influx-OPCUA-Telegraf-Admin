# Telegraf Configuration — OPC UA Demo Stack
# Pre-configured for the Microsoft OPC PLC Simulator
# (mcr.microsoft.com/iotedge/opc-plc)
#
# This file is used by the sample docker-compose stack.
# For production use, generate your telegraf.conf from the Admin Portal
# and replace this file.

[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = ""
  hostname = ""
  omit_hostname = false

# ── InfluxDB v2 Output ──────────────────────────────────────────────────────
[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]
  token = "my-super-secret-admin-token"
  organization = "opcua-demo"
  bucket = "opcua"

# ── OPC UA Input — Simulated Telemetry (1 second scan) ─────────────────────
#
# Node IDs provided by the Microsoft OPC PLC simulator.
# Browse the full node tree at: http://localhost:8080/pn.json
# or via the Admin Portal → Devices → Browse.
#
[[inputs.opcua]]
  name = "opc_plc_fast"
  endpoint = "opc.tcp://opc-plc:50000"
  connect_timeout = "10s"
  request_timeout = "5s"
  connect_fail_behavior = "ignore"
  interval = "1s"

  ## ── Basic Telemetry Nodes ──────────────────────────────────────────────
  [[inputs.opcua.nodes]]
    name = "AlternatingBoolean"
    namespace = "2"
    identifier_type = "s"
    identifier = "AlternatingBoolean"
    tags = {measurement = "opc_plc_telemetry", scanClass = "fast"}

  [[inputs.opcua.nodes]]
    name = "RandomSignedInt32"
    namespace = "2"
    identifier_type = "s"
    identifier = "RandomSignedInt32"
    tags = {measurement = "opc_plc_telemetry", scanClass = "fast"}

  [[inputs.opcua.nodes]]
    name = "RandomUnsignedInt32"
    namespace = "2"
    identifier_type = "s"
    identifier = "RandomUnsignedInt32"
    tags = {measurement = "opc_plc_telemetry", scanClass = "fast"}

  [[inputs.opcua.nodes]]
    name = "SpikeData"
    namespace = "2"
    identifier_type = "s"
    identifier = "SpikeData"
    tags = {measurement = "opc_plc_telemetry", scanClass = "fast"}

  [[inputs.opcua.nodes]]
    name = "DipData"
    namespace = "2"
    identifier_type = "s"
    identifier = "DipData"
    tags = {measurement = "opc_plc_telemetry", scanClass = "fast"}

  [[inputs.opcua.nodes]]
    name = "StepUp"
    namespace = "2"
    identifier_type = "s"
    identifier = "StepUp"
    tags = {measurement = "opc_plc_telemetry", scanClass = "fast"}

# ── OPC UA Input — Trend Data (10 second scan) ─────────────────────────────
[[inputs.opcua]]
  name = "opc_plc_slow"
  endpoint = "opc.tcp://opc-plc:50000"
  connect_timeout = "10s"
  request_timeout = "5s"
  connect_fail_behavior = "ignore"
  interval = "10s"

  [[inputs.opcua.nodes]]
    name = "NegativeTrendData"
    namespace = "2"
    identifier_type = "s"
    identifier = "NegativeTrendData"
    tags = {measurement = "opc_plc_trends", scanClass = "slow"}

  [[inputs.opcua.nodes]]
    name = "PositiveTrendData"
    namespace = "2"
    identifier_type = "s"
    identifier = "PositiveTrendData"
    tags = {measurement = "opc_plc_trends", scanClass = "slow"}

  [[inputs.opcua.nodes]]
    name = "RandomUnsignedInt32"
    namespace = "2"
    identifier_type = "s"
    identifier = "RandomUnsignedInt32"
    tags = {measurement = "opc_plc_trends", scanClass = "slow"}
