# Telegraf Configuration — OPC UA Demo Stack
# Pre-configured for the IoTech OPC UA Simulator (iotechsys/opc-ua-sim:1.2)
# and InfluxDB 3 Core (influxdb:3-core).
#
# Nodes are defined by the bundled example-scripts/simulation.lua:
#   Namespace 2 ("Static")    — scalar data-type nodes (Bool, Int32, Double, …)
#   Namespace 3 ("Simulation") — dynamic waveform nodes (Counter, Random,
#                                  Sawtooth, Sinusoid, Square, Triangle)
#
# This file is used by the sample docker-compose stack.
# For production use, generate your telegraf.conf from the Admin Portal
# and replace this file.

[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = ""
  hostname = ""
  omit_hostname = false

# ── InfluxDB v2 Output ──────────────────────────────────────────────────────
#  InfluxDB 3 Core accepts writes via the v2-compatible write API on port 8181.
[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8181"]
  token = "apiv3_opcua-demo-admin-token-local-dev-only-00000000"
  bucket = "opcua"

# ── OPC UA Input — Simulation Waveforms (1 second scan) ────────────────────
#
# Node IDs from the IoTech simulation.lua example script (namespace 3).
# All nodes are read-only DOUBLE values that update continuously.
#
[[inputs.opcua]]
  name = "opc_sim_fast"
  endpoint = "opc.tcp://opc-ua-sim:49947"
  connect_timeout = "10s"
  request_timeout = "5s"
  connect_fail_behavior = "ignore"
  interval = "1s"

  [[inputs.opcua.nodes]]
    name = "Counter"
    namespace = "3"
    identifier_type = "s"
    identifier = "Counter"
    tags = {measurement = "opc_sim_telemetry", scanClass = "fast"}

  [[inputs.opcua.nodes]]
    name = "Random"
    namespace = "3"
    identifier_type = "s"
    identifier = "Random"
    tags = {measurement = "opc_sim_telemetry", scanClass = "fast"}

  [[inputs.opcua.nodes]]
    name = "Sawtooth"
    namespace = "3"
    identifier_type = "s"
    identifier = "Sawtooth"
    tags = {measurement = "opc_sim_telemetry", scanClass = "fast"}

  [[inputs.opcua.nodes]]
    name = "Sinusoid"
    namespace = "3"
    identifier_type = "s"
    identifier = "Sinusoid"
    tags = {measurement = "opc_sim_telemetry", scanClass = "fast"}

  [[inputs.opcua.nodes]]
    name = "Square"
    namespace = "3"
    identifier_type = "s"
    identifier = "Square"
    tags = {measurement = "opc_sim_telemetry", scanClass = "fast"}

  [[inputs.opcua.nodes]]
    name = "Triangle"
    namespace = "3"
    identifier_type = "s"
    identifier = "Triangle"
    tags = {measurement = "opc_sim_telemetry", scanClass = "fast"}

# ── OPC UA Input — Static Data Types (10 second scan) ──────────────────────
#
# Node IDs from the IoTech simulation.lua example script (namespace 2).
# These are read/write scalar nodes — useful for testing write-back.
#
[[inputs.opcua]]
  name = "opc_sim_slow"
  endpoint = "opc.tcp://opc-ua-sim:49947"
  connect_timeout = "10s"
  request_timeout = "5s"
  connect_fail_behavior = "ignore"
  interval = "10s"

  [[inputs.opcua.nodes]]
    name = "Int32"
    namespace = "2"
    identifier_type = "s"
    identifier = "Int32"
    tags = {measurement = "opc_sim_static", scanClass = "slow"}

  [[inputs.opcua.nodes]]
    name = "Float"
    namespace = "2"
    identifier_type = "s"
    identifier = "Float"
    tags = {measurement = "opc_sim_static", scanClass = "slow"}

  [[inputs.opcua.nodes]]
    name = "Double"
    namespace = "2"
    identifier_type = "s"
    identifier = "Double"
    tags = {measurement = "opc_sim_static", scanClass = "slow"}
